<!DOCTYPE html>



  



<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Jax's Blog" />










<meta property="og:type" content="website">
<meta property="og:title" content="You define me">
<meta property="og:url" content="http://17wpw.com/index.html">
<meta property="og:site_name" content="You define me">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="You define me">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://17wpw.com/"/>





  <title>You define me</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?92096bcd95c9aa461a04e26f626852fd";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">You define me</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://17wpw.com/2019/09/27/frd开启Https/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jax">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/class.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="You define me">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/27/frd开启Https/" itemprop="url">frp开启https</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-27T17:01:00+08:00">
                2019-09-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="frp的搭建"><a href="#frp的搭建" class="headerlink" title="frp的搭建"></a>frp的搭建</h2><p>看另外一篇文章 ： <a href="https://www.17wpw.com/2018/11/27/frd%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" target="_blank" rel="external">frp搭建内网穿透服务</a></p>
<h2 id="首先开启服务端的https请求端口"><a href="#首先开启服务端的https请求端口" class="headerlink" title="首先开启服务端的https请求端口"></a>首先开启服务端的https请求端口</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[common]</div><div class="line"># frp 服务所使用的端口</div><div class="line">bind_port = 7000           </div><div class="line"># HTTPS 协议建议使用 443 端口</div><div class="line">vhost_https_port = 443     </div><div class="line"># HTTP 协议建议使用 80 端口</div><div class="line">vhost_http_port = 80</div></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/09/27/frd开启Https/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://17wpw.com/2019/06/11/详解分布式事务之 Seata-Client 原理及流程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jax">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/class.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="You define me">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/11/详解分布式事务之 Seata-Client 原理及流程/" itemprop="url">详解分布式事务之 Seata-Client 原理及流程</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-11T17:01:00+08:00">
                2019-06-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在分布式系统中，分布式事务是一个必须要解决的问题，目前使用较多的是最终一致性方案。自年初阿里开源了Fescar（四月初更名为Seata）后，该项目受到了极大的关注，目前已接近 8000 Star。Seata 以高性能和零侵入的特性为目标解决微服务领域的分布式事务难题，目前正处于快速迭代中，近期小目标是生产可用的 Mysql 版本。<br>基于 spring cloud + spring jpa + spring cloud alibaba fescar + mysql + seata 的结构，搭建一个分布式系统的 demo，通过 seata 的 debug 日志和源代码，从 client 端（RM、TM）的角度分析其工作流程及原理。（示例项目：<a href="https://github.com/fescar-group/fescar-samples/tree/master/springcloud-jpa-seata）" target="_blank" rel="external">https://github.com/fescar-group/fescar-samples/tree/master/springcloud-jpa-seata）</a><br>为了更好地理解，我们来熟悉一下相关概念：</p>
<ul>
<li>XID：全局事务的唯一标识，由 ip:port:sequence 组成；</li>
<li>Transaction Coordinator (TC)：事务协调器，维护全局事务的运行状态，负责协调并驱动全局事务的提交或回滚；</li>
<li>Transaction Manager (TM )：控制全局事务的边界，负责开启一个全局事务，并最终发起全局提交或全局回滚的决议；</li>
<li>Resource Manager (RM)：控制分支事务，负责分支注册、状态汇报，并接收事务协调器的指令，驱动分支（本地）事务的提交和回滚；<br>提示：文中代码是基于 fescar-0.4.1 版本，由于项目刚更名为 seata 不久，其中一些包名、类名、jar包等名称还没统一更换过来，故下文中仍使用 fescar 进行表述。
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/06/11/详解分布式事务之 Seata-Client 原理及流程/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://17wpw.com/2019/04/11/使用nacos做注册中心导致log4j日志服务异常/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jax">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/class.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="You define me">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/11/使用nacos做注册中心导致log4j日志服务异常/" itemprop="url">使用nacos做注册中心导致log4j日志服务异常</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-11T17:01:00+08:00">
                2019-04-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="问题起源"><a href="#问题起源" class="headerlink" title="问题起源"></a>问题起源</h2><p>日志框架用的log4j，接入阿里云Alibaba Cloud Log Log4j Appender做日志采集，以及错误预警。某天发现线上无法正常采集日志数据，怀疑是dubbo日志包冲突影响导致。报错信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">main DEBUG Using configurationFactory org.apache.logging.log4j.core.config.ConfigurationFactory$Factory@1153ee42</div><div class="line"></div><div class="line">main DEBUG Closing JarURLInputStream sun.net.www.protocol.jar.JarURLConnection$JarURLInputStream@31fcad71</div><div class="line"></div><div class="line">main WARN No Root logger was configured, creating default ERROR-level Root logger with Console appender</div></pre></td></tr></table></figure></p>
<h2 id="问题追溯"><a href="#问题追溯" class="headerlink" title="问题追溯"></a>问题追溯</h2><p>IDEA有个功能，可以查看maven项目依赖总览图。如图所示功能：<br><img src="http://rblc.oss-cn-qingdao.aliyuncs.com/ftp/1561100811530.jpg" alt="image"><br>这样很方便就可以找到是哪个jar包包含的依赖有冲突。<br>去除了dubbo的log4j依赖，问题依然重现。再判断是否nacos导致的。查看nacos源码发现以下代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">Log4J2NacosLogging</span><span class="params">()</span> </span>&#123;</div><div class="line">        String location = <span class="keyword">this</span>.getLocation(<span class="string">"classpath:nacos-log4j2.xml"</span>);</div><div class="line">        <span class="keyword">if</span>(!StringUtils.isBlank(location)) &#123;</div><div class="line">            <span class="keyword">this</span>.locationList.add(location);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadConfiguration</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(!<span class="keyword">this</span>.locationList.isEmpty()) &#123;</div><div class="line">            List configList = <span class="keyword">this</span>.findConfig(<span class="keyword">this</span>.getCurrentlySupportedConfigLocations());</div><div class="line">            <span class="keyword">if</span>(configList != <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">this</span>.locationList.addAll(configList);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            ArrayList configurations = <span class="keyword">new</span> ArrayList();</div><div class="line">            LoggerContext loggerContext = (LoggerContext)LogManager.getContext(<span class="keyword">false</span>);</div><div class="line">            Iterator compositeConfiguration = <span class="keyword">this</span>.locationList.iterator();</div><div class="line"></div><div class="line">            <span class="keyword">while</span>(compositeConfiguration.hasNext()) &#123;</div><div class="line">                String location = (String)compositeConfiguration.next();</div><div class="line"></div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    Configuration e = <span class="keyword">this</span>.loadConfiguration(loggerContext, location);</div><div class="line">                    <span class="keyword">if</span>(e <span class="keyword">instanceof</span> AbstractConfiguration) &#123;</div><div class="line">                        configurations.add((AbstractConfiguration)e);</div><div class="line">                    &#125;</div><div class="line">                &#125; <span class="keyword">catch</span> (Exception var7) &#123;</div><div class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Could not initialize Log4J2 Nacos logging from "</span> + location, var7);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            CompositeConfiguration compositeConfiguration1 = <span class="keyword">new</span> CompositeConfiguration(configurations);</div><div class="line">            loggerContext.start(compositeConfiguration1);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p><strong>nacos注册中心会查找nacos的日志配置文件，如果找不到怎么办呢，再下面代码：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> String[] getCurrentlySupportedConfigLocations() &#123;</div><div class="line">        ArrayList supportedConfigLocations = <span class="keyword">new</span> ArrayList();</div><div class="line">        <span class="keyword">if</span>(ClassUtils.isPresent(<span class="string">"com.fasterxml.jackson.dataformat.yaml.YAMLParser"</span>)) &#123;</div><div class="line">            Collections.addAll(supportedConfigLocations, <span class="keyword">new</span> String[]&#123;<span class="string">"log4j2.yaml"</span>, <span class="string">"log4j2.yml"</span>, <span class="string">"log4j2-test.yaml"</span>, <span class="string">"log4j2-test.yml"</span>&#125;);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(ClassUtils.isPresent(<span class="string">"com.fasterxml.jackson.databind.ObjectMapper"</span>)) &#123;</div><div class="line">            Collections.addAll(supportedConfigLocations, <span class="keyword">new</span> String[]&#123;<span class="string">"log4j2.json"</span>, <span class="string">"log4j2.jsn"</span>, <span class="string">"log4j2-test.json"</span>, <span class="string">"log4j2-test.jsn"</span>&#125;);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        supportedConfigLocations.add(<span class="string">"log4j2.xml"</span>);</div><div class="line">        supportedConfigLocations.add(<span class="string">"log4j2-test.xml"</span>);</div><div class="line">        <span class="keyword">return</span> (String[])supportedConfigLocations.toArray(<span class="keyword">new</span> String[supportedConfigLocations.size()]);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>nacos会引用它默认的配置信息，导致之前项目的log4j配置失效。如何禁用nacos的默认配置，在它配置工厂类有写： </p>
<pre><code class="java"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isDefaultConfigEnabled</span><span class="params">()</span> </span>{
        String property = System.getProperty(<span class="string">"nacos.logging.default.config.enabled"</span>);
        <span class="keyword">return</span> property == <span class="keyword">null</span> || BooleanUtils.toBoolean(property);
}
</code></pre>
<p>我们只需要在系统变量中设置nacos.logging.default.config.enabled=false,然后把nacos的日志配置信息放到我们项目中的log4j文件中即可，在nacos-client源码中我们可以找到log4j以及logback的写法。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://17wpw.com/2019/03/12/打造云上DevOps，基于阿里云codepipeline，docker做持续交付实践/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jax">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/class.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="You define me">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/12/打造云上DevOps，基于阿里云codepipeline，docker做持续交付实践/" itemprop="url">打造云上DevOps，基于阿里云codepipeline，docker做持续交付实践</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-12T11:00:00+08:00">
                2019-03-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>项目进行服务化改造之后，dubbo服务加上其他应用服务有上十个微服务需要构建，面临一个服务发布以及运维工作量剧增。业内比较常用的自动构建工具是Jenkins。看一下它的流程以及工具集：<br><img src="http://rblc.oss-cn-qingdao.aliyuncs.com/ftp/WechatIMG740.jpeg" alt="image"><br>可以看到，非常强大，同时也非常复杂。网上收集整理出来的几大问题。</p>
<ol>
<li>架构陈旧，性能底下。（250个slave，1000个job）。</li>
<li>安全漏洞频发</li>
<li>运维成本大</li>
<li>缺乏完善的权限模型</li>
</ol>
<p>最终选型落在阿里云的codepipeline，目前免费中，估计后期肯定会收费，阿里云一贯的作风，先免费后收费。</p>
<h2 id="codepipeline介绍"><a href="#codepipeline介绍" class="headerlink" title="codepipeline介绍"></a>codepipeline介绍</h2><p>阿里云CodePipeline是兼容Jenkins标准的、提供快速可靠的持续集成与持续交付服务。基于容器技术和阿里云基础服务架构，提供稳定和安全的代码/Docker编译构建，测试，扫描和部署的工具服务，并提供Pipeline As Code的编码级配置模式，满足应用程序和基础设施快速可靠的交付和更新。</p>
<h2 id="开通CodePipeline"><a href="#开通CodePipeline" class="headerlink" title="开通CodePipeline"></a>开通CodePipeline</h2><ol>
<li>开通CodePipeline<ol>
<li>登录阿里云控制如后，通过如下导航找到CodePipeline。<br><img src="evernotecid://DFAC5A47-22E8-4AB2-BC28-74CF7EB6977B/wwwevernotecom/9163462/ENResource/p47" alt="cbedb20e3464587ff60fa781fd71ef8d.png"></li>
<li>点击图中菜单按钮来到服务开通页面，点击开通服务按钮.</li>
</ol>
</li>
<li>创建项目和运行项目<ol>
<li>登录阿里云控制台后，通过菜单导航到CodePipeline后，出现如下界面。</li>
<li>点击新建按键，来到创建项目导航页面。输入项目名称Cloud_DevOps，并选择Java项目，点击下一步，</li>
<li>来到代码配置构建页面，在“仓库地址”中输入如下代码，这是一个普通的Java Web示例项目，可以通过Git Clone后查看其内容。</li>
</ol>
</li>
</ol>
<h2 id="CodePipeline架构"><a href="#CodePipeline架构" class="headerlink" title="CodePipeline架构"></a>CodePipeline架构</h2><p><img src="http://rblc.oss-cn-qingdao.aliyuncs.com/ftp/1561476421935.jpg" alt="image"></p>
<h2 id="CodePipeline部署流程"><a href="#CodePipeline部署流程" class="headerlink" title="CodePipeline部署流程"></a>CodePipeline部署流程</h2><p><img src="http://rblc.oss-cn-qingdao.aliyuncs.com/ftp/demo.jpg" alt="image"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://17wpw.com/2019/02/22/阿里云服务器专有网络连接FTP失败/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jax">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/class.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="You define me">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/22/阿里云服务器专有网络连接FTP失败/" itemprop="url">阿里云服务器专有网络环境下链接FTP失败</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-22T17:01:00+08:00">
                2019-02-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="问题显示"><a href="#问题显示" class="headerlink" title="问题显示"></a>问题显示</h2><p>服务器：阿里云ECS<br>网络环境：专有网络<br>FTP服务：vsftpd<br>连接异常：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">状态: 	已登录&lt;br&gt;</div><div class="line">状态: 	读取目录列表...  </div><div class="line">状态: 	服务器发回了不可路由的地址。被动模式失败。  </div><div class="line">命令: 	PORT 172,20,10,5,229,9  </div><div class="line">响应: 	500 Illegal PORT command.  </div><div class="line">错误: 	读取目录列表失败</div></pre></td></tr></table></figure></p>
<p><img src="http://bbs.aliyun.com/attachment/Fid_239/239_1477160476054779_ccd835e45418095.png?27"></p>
<h2 id="问题追溯"><a href="#问题追溯" class="headerlink" title="问题追溯"></a>问题追溯</h2><p>原因：专有网络的ECS系统中，没有公网IP地址，是经NAT与互联网连接，且ECS创建过程中的默认安全组规则没有针对FTP的快捷选项。建议在Linux系统里使用sftp协议替换ftp使用。 。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><ol>
<li><p>修改vsftpd配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">pasv_enable=YES  # 启用pasv模式</div><div class="line">pasv_min_port=30000 # 设置pasv模式中的可用端口范围（开始）</div><div class="line">pasv_max_port=30100 # 设置pasv模式中的可用端口范围（结束）</div><div class="line">pasv_address=39.108.4.89 # 设置pasv模式中的外网IP</div><div class="line">seccomp_sandbox=NO # 关闭 seccomp 功能</div></pre></td></tr></table></figure>
</li>
<li><p>在ECS实例安全组中，分别增加两条规则，允许相应的tcp端口访问（tcp 21端口，和 tcp 3000到30100端口）<br><img src="http://bbs.aliyun.com/attachment/thumb/Fid_239/239_1477160476054779_92929ba164b97e1.png?29"></p>
</li>
<li>重启vsftpd服务。客户端传输设置改成主动模式，fileZilla被动模式设置该生：退回到主动模式。<br><img src="http://bbs.aliyun.com/attachment/Fid_239/239_1477160476054779_463b15cac552169.png?14"></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://17wpw.com/2019/01/23/dubbo服务在docker容器中进行服务编排/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jax">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/class.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="You define me">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/23/dubbo服务在docker容器中进行服务编排/" itemprop="url">dubbo服务在docker容器中进行服务编排</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-23T17:01:00+08:00">
                2019-01-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="问题起源"><a href="#问题起源" class="headerlink" title="问题起源"></a>问题起源</h2><p>最近在对现有业务系统进行Dubbo服务化重构，部署方式采用Docker部署，注册中心采用nacos。当部署完成之后会发现消费者服务能正常启动，服务在注册中心显示正常，但是进行服务调用的时候就会报错，对应的服务无响应信息。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">com.alibaba.dubbo.remoting.RemotingException: message can not send, because channel is closed</div></pre></td></tr></table></figure></p>
<h2 id="问题追溯"><a href="#问题追溯" class="headerlink" title="问题追溯"></a>问题追溯</h2><p>报错信息显示comsumer地址是172.18.<code>*</code>.<code>*</code>，这是docker容器的ip地址，猜想应该是容器之间无法进行调用。把docker服务启动参数修改成宿主机的内网地址，依然还是报错。是否应该是服务端口号不一致？查看dubbo端口绑定源码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">     * Register port and bind port for the provider, can be configured separately</div><div class="line">     * Configuration priority: environment variable -&gt; java system properties -&gt; port property in protocol config file</div><div class="line">     * -&gt; protocol default port</div><div class="line">     *</div><div class="line">     * @param protocolConfig</div><div class="line">     * @param name</div><div class="line">     * @return</div><div class="line">     */</div><div class="line">    private Integer findConfigedPorts(ProtocolConfig protocolConfig, String name, Map&lt;String, String&gt; map) &#123;</div><div class="line">        Integer portToBind = null;</div><div class="line"> </div><div class="line">        // parse bind port from environment</div><div class="line">        String port = getValueFromConfig(protocolConfig, Constants.DUBBO_PORT_TO_BIND);</div><div class="line">        portToBind = parsePort(port);</div><div class="line"> </div><div class="line">        // if there&apos;s no bind port found from environment, keep looking up.</div><div class="line">        if (portToBind == null) &#123;</div><div class="line">            portToBind = protocolConfig.getPort();</div><div class="line">            if (provider != null &amp;&amp; (portToBind == null || portToBind == 0)) &#123;</div><div class="line">                portToBind = provider.getPort();</div><div class="line">            &#125;</div><div class="line">            final int defaultPort = ExtensionLoader.getExtensionLoader(Protocol.class).getExtension(name).getDefaultPort();</div><div class="line">            if (portToBind == null || portToBind == 0) &#123;</div><div class="line">                portToBind = defaultPort;</div><div class="line">            &#125;</div><div class="line">            if (portToBind == null || portToBind &lt;= 0) &#123;</div><div class="line">                portToBind = getRandomPort(name);</div><div class="line">                if (portToBind == null || portToBind &lt; 0) &#123;</div><div class="line">                    portToBind = getAvailablePort(defaultPort);</div><div class="line">                    putRandomPort(name, portToBind);</div><div class="line">                &#125;</div><div class="line">                logger.warn(&quot;Use random available port(&quot; + portToBind + &quot;) for protocol &quot; + name);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"> </div><div class="line">        // save bind port, used as url&apos;s key later</div><div class="line">        map.put(Constants.BIND_PORT_KEY, String.valueOf(portToBind));</div><div class="line"> </div><div class="line">        // registry port, not used as bind port by default</div><div class="line">        String portToRegistryStr = getValueFromConfig(protocolConfig, Constants.DUBBO_PORT_TO_REGISTRY);</div><div class="line">        Integer portToRegistry = parsePort(portToRegistryStr);</div><div class="line">        if (portToRegistry == null) &#123;</div><div class="line">            portToRegistry = portToBind;</div><div class="line">        &#125;</div><div class="line"> </div><div class="line">        return portToRegistry;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>整个方法最核心的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String port = getValueFromConfig(protocolConfig, Constants.DUBBO_PORT_TO_BIND);</div></pre></td></tr></table></figure>
<p>通过读取系统环境变量：DUBBO_PORT_TO_BIND获取暴露端口。如何修改这个参数呢？想到了docker三剑客之docker-compose。现在多个服务要逐个启动，正好使用compose可以解决这个问题。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/01/23/dubbo服务在docker容器中进行服务编排/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://17wpw.com/2018/12/20/基于阿里云MQ服务封装的spring-boot模块/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jax">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/class.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="You define me">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/20/基于阿里云MQ服务封装的spring-boot模块/" itemprop="url">spring boot starter for aliYunMQ</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-20T19:02:00+08:00">
                2018-12-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="spring-boot-starter-for-aliYunMQ"><a href="#spring-boot-starter-for-aliYunMQ" class="headerlink" title="spring boot starter for aliYunMQ"></a>spring boot starter for aliYunMQ</h2><h3 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h3><p><a href="https://www.aliyun.com/product/rocketmq?spm=5176.8142029.search.1.e9396d3ebT5xIC" target="_blank" rel="external">消息队列 RocketMQ </a>是阿里巴巴自研消息产品，服务于整个集团已超过 13 年，经过阿里巴巴交易核心链路反复打磨与历年双十一购物狂欢节的严苛考验，是一个真正具备低延迟、高并发、高可用、高可靠，可支撑万亿级数据洪峰的分布式消息中间件。</p>
<p>本模块实现了阿里云MQ的以下几个功能。</p>
<ul>
<li>[x] 同步发送消息</li>
<li>[x] 异步发送消息</li>
<li>[x] 广播发送消息</li>
<li>[x] 有序发送和消费消息</li>
<li>[x] 发送延时消息</li>
<li>[x] 消息tag支持</li>
<li>[x] 自动序列化和反序列化消息体</li>
<li>[x] 发送事务消息</li>
</ul>
<h3 id="如何集成"><a href="#如何集成" class="headerlink" title="如何集成"></a>如何集成</h3><h5 id="1、添加依赖"><a href="#1、添加依赖" class="headerlink" title="1、添加依赖"></a>1、添加依赖</h5><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">  &lt;groupId&gt;com.shopping&lt;/groupId&gt;</div><div class="line">  &lt;artifactId&gt;spring-boot-starter-aliyunmq&lt;/artifactId&gt;</div><div class="line">  &lt;version&gt;1.0.0.RELEASE&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<p>因为我们有自己的maven私库，所以没有po到maven公有库里。配置代码库：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;repositories&gt;</div><div class="line">    &lt;repository&gt;</div><div class="line">        &lt;id&gt;shopping&lt;/id&gt;</div><div class="line">        &lt;url&gt;http://maven.sucok.com/content/groups/public&lt;/url&gt;</div><div class="line">    &lt;/repository&gt;</div><div class="line">    &lt;repository&gt;</div><div class="line">        &lt;id&gt;sonatype-nexus-staging&lt;/id&gt;</div><div class="line">        &lt;name&gt;Sonatype Nexus Staging&lt;/name&gt;</div><div class="line">        &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public&lt;/url&gt;</div><div class="line">        &lt;releases&gt;</div><div class="line">            &lt;enabled&gt;true&lt;/enabled&gt;</div><div class="line">        &lt;/releases&gt;</div><div class="line">        &lt;snapshots&gt;</div><div class="line">            &lt;enabled&gt;true&lt;/enabled&gt;</div><div class="line">        &lt;/snapshots&gt;</div><div class="line">    &lt;/repository&gt;</div><div class="line">&lt;/repositories&gt;</div></pre></td></tr></table></figure>
<h4 id="2、添加配置"><a href="#2、添加配置" class="headerlink" title="2、添加配置"></a>2、添加配置</h4><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">aliyun.mq.onsAddr=&lt;地址&gt;</div><div class="line">aliyun.mq.accessKey=</div><div class="line">aliyun.mq.secretKey=</div><div class="line">aliyun.mq.TopicIdRblc=</div><div class="line">#为false表示不引入producer，为true则producerId必须提供</div><div class="line">aliyun.mq.producer.enabled=true</div><div class="line">aliyun.mq.producer.producerId=</div><div class="line">#为false表示不引入consumer，为true则consumerId必须提供</div><div class="line">aliyun.mq.consumer.enabled=true</div></pre></td></tr></table></figure>
<h4 id="3、添加生产者"><a href="#3、添加生产者" class="headerlink" title="3、添加生产者"></a>3、添加生产者</h4><blockquote>
<p>顺序消息</p>
</blockquote>
<p>按照消息的发布顺序进行顺序消费（FIFO），支持全局顺序与分区顺序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Autowired</span></div><div class="line">OrderMessageTemplate orderMessageTemplate;</div><div class="line"></div><div class="line"><span class="comment">//发送</span></div><div class="line">orderMessageTemplate(<span class="keyword">new</span> MessageEvent(<span class="string">"&#123;topic&#125;"</span>, <span class="string">"&#123;tag&#125;"</span>, msgBody));</div></pre></td></tr></table></figure>
<blockquote>
<p>普通消息,定时消息,延迟消息生产者</p>
</blockquote>
<p>消息可在指定的时间点(如2019/01/01 15:00:00)或延迟时间(如30分钟后)进行投递</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Autowired</span></div><div class="line">RocketMQTemplate rocketMQTemplate;</div><div class="line"></div><div class="line"><span class="comment">// 发送普通消息</span></div><div class="line">rocketMQTemplate.send(<span class="keyword">new</span> MessageEvent(<span class="string">"&#123;topic&#125;"</span>, <span class="string">"&#123;tag&#125;"</span>, msgBody));</div><div class="line"><span class="comment">// 延时消息，单位毫秒（ms），在指定延迟时间（当前时间之后）进行投递，例如消息在 3 秒后投递</span></div><div class="line">rocketMQTemplate.sendAsync(<span class="keyword">new</span> MessageEvent(<span class="string">"&#123;topic&#125;"</span>, <span class="string">"&#123;tag&#125;"</span>, msgBody),<span class="number">3000</span>);</div><div class="line"><span class="comment">// 延时消息，指定时间进行投递。例如消息在1天之后投递</span></div><div class="line">Calendar cal = Calendar.getInstance();</div><div class="line">cal.setTime(date);</div><div class="line">cal.add(Calendar.DATE, <span class="number">1</span>);</div><div class="line">rocketMQTemplate.sendAsync(<span class="keyword">new</span> MessageEvent(<span class="string">"&#123;topic&#125;"</span>, <span class="string">"&#123;tag&#125;"</span>, msgBody), cal.getTime(););</div></pre></td></tr></table></figure>
<blockquote>
<p>事务消息</p>
</blockquote>
<p>类似 X/Open XA 的分布事务功能，既可做到系统间的解耦，又能保证数据的最终一致性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Autowired</span></div><div class="line">TransactionMessageTemplate messageTemplate;</div><div class="line"></div><div class="line"><span class="comment">// 发送事务消息</span></div><div class="line"><span class="comment">/**封装消息*/</span></div><div class="line">MessageEvent event = <span class="keyword">new</span> MessageEvent();</div><div class="line">event.setTopic(<span class="string">"base_sms"</span>);</div><div class="line">event.setTag(<span class="string">"Tag_user"</span>);</div><div class="line">   </div><div class="line">User user = <span class="keyword">new</span> User();</div><div class="line">user.setName(<span class="string">"Paul"</span>);</div><div class="line">user.setAdds(<span class="string">"北京市 昌平区 龙锦苑东二区"</span>);</div><div class="line"> <span class="comment">/**封装任意类型领域对象*/</span></div><div class="line">event.setDomain(user);</div><div class="line">    </div><div class="line">transactionMessageTemplate.send(event,<span class="keyword">new</span> TransactionExecuter() &#123;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> TransactionStatus <span class="title">executer</span><span class="params">(MessageEvent messageEvent, Long hashValue, Object arg)</span> </span>&#123;</div><div class="line">	String transactionId = TransactionDemo.createTransaction();</div><div class="line">	TransactionStatus status = TransactionDemo.checker();</div><div class="line">	<span class="keyword">return</span> status;</div><div class="line">&#125;</div><div class="line">),<span class="string">"参数对象,以本字符串示例,会传递给TransactionExecuter.executer"</span>);</div></pre></td></tr></table></figure>
<h4 id="4、添加订阅者"><a href="#4、添加订阅者" class="headerlink" title="4、添加订阅者"></a>4、添加订阅者</h4><blockquote>
<p>普通消息订阅者，实现AbstractMessageListener接口</p>
</blockquote>
<ul>
<li>topic：支持SpringEl风格，取配置文件中的值。(必填)  </li>
<li>tag：标签。* 标识所有。  (必填)  </li>
<li>consumerId：消费者Id。  (必填)  </li>
<li>consumeMode：消费模式 有序（单线程）或者无序（多线程） （默认无序）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RocketMQMessageListener</span>(topic = <span class="string">"$&#123;aliyun.mq.TopicIdRblc&#125;"</span>, tag = <span class="string">"giveCoupon"</span>, consumerId = <span class="string">"CID_shopping_giveCoupon"</span>, consumeMode = MessageExtConst.CONSUME_MODE_ORDERLY)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GiveCouponMessageListener</span> <span class="keyword">extends</span> <span class="title">AbstractMessageListener</span>&lt;<span class="title">MessageEvent</span>&gt; </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 消息处理</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(MessageEvent messageEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    	<span class="comment">//TODO 业务处理</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>顺序消息订阅者，实现AbstractMessageOrderListener</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RocketMQMessageListener</span>(topic = <span class="string">"$&#123;aliyun.mq.TopicIdRblc&#125;"</span>, tag = <span class="string">"giveCoupon"</span>, consumerId = <span class="string">"CID_shopping_giveCoupon"</span>, consumeMode = MessageExtConst.CONSUME_MODE_ORDERLY)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GiveCouponMessageListener</span> <span class="keyword">extends</span> <span class="title">AbstractMessageOrderListener</span> &lt;<span class="title">MessageEvent</span>&gt; </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 消息处理</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(MessageEvent messageEvent)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    	<span class="comment">//TODO 业务处理</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="5、相关参考"><a href="#5、相关参考" class="headerlink" title="5、相关参考"></a>5、相关参考</h4><ul>
<li>官网Demo地址：<a href="https://github.com/AliwareMQ/mq-demo" target="_blank" rel="external">https://github.com/AliwareMQ/mq-demo</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://17wpw.com/2018/11/27/frd内网穿透/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jax">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/class.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="You define me">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/27/frd内网穿透/" itemprop="url">frd搭建内网穿透服务</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-27T17:01:00+08:00">
                2018-11-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="frp-的作用"><a href="#frp-的作用" class="headerlink" title="frp 的作用"></a>frp 的作用</h2><ul>
<li>利用处于内网或防火墙后的机器，对外网环境提供 http 或 https 服务。</li>
<li>对于 http, https 服务支持基于域名的虚拟主机，支持自定义域名绑定，使多个域名可以共用一个80端口。</li>
<li>利用处于内网或防火墙后的机器，对外网环境提供 tcp 和 udp 服务，例如在家里通过 ssh 访问处于公司内网环境内的主机。</li>
</ul>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><p><img src="https://github.com/fatedier/frp/raw/master/doc/pic/architecture.png"></p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/11/27/frd内网穿透/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://17wpw.com/2018/11/23/druid时区设置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jax">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/class.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="You define me">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/23/druid时区设置/" itemprop="url">druid时区设置</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-23T17:01:00+08:00">
                2018-11-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>使用druid最为连接池。发现保存数据与系统相差8小时</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>设置druid时区参数：serverTimezone为GMT+8，如：</p>
<blockquote>
<p>jdbc:mysql://localhost:3306/rblcmall?serverTimezone=GMT%2B8&amp;createDatabaseIfNotExist=true&amp;useUnicode=true&amp;useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;v </p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://17wpw.com/2018/11/23/dev收藏网站/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jax">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/class.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="You define me">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/23/dev收藏网站/" itemprop="url">java开发工具类网站</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-23T17:01:00+08:00">
                2018-11-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="yml文件与properties文件互转"><a href="#yml文件与properties文件互转" class="headerlink" title="yml文件与properties文件互转"></a>yml文件与properties文件互转</h5><blockquote>
<p><a href="http://www.toyaml.com/index.html" target="_blank" rel="external">http://www.toyaml.com/index.html</a></p>
</blockquote>
<p>#### </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/class.jpg"
                alt="Jax" />
            
              <p class="site-author-name" itemprop="name">Jax</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">39</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/txlaijava" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:5681540@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://tuchong.com/1515111/" target="_blank" title="摄影/图虫">
                      
                        <i class="fa fa-fw fa-instagram"></i>摄影/图虫</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2014 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jax</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>








        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->


    

    







  





  

  

  

  
  

  

  

  

</body>
</html>
